# AWS Distro for OpenTelemetry (ADOT) Collector ì„¤ì •
# ì´ íŒŒì¼ì€ MoniKitì—ì„œ ì „ì†¡í•œ OTLP ë°ì´í„°ë¥¼ AWS ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317  # MoniKitì´ ì—°ê²°í•  í¬íŠ¸
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch:
    timeout: 1s
    send_batch_size: 1024
  
  # ğŸ”¥ Sampling ì²˜ë¦¬ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì´ë¯¸ ì²˜ë¦¬ë˜ë¯€ë¡œ ì„ íƒì‚¬í•­)
  probabilistic_sampler:
    sampling_percentage: 10  # 10% ìƒ˜í”Œë§ (ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ê³¼ ì¤‘ë³µ ê°€ëŠ¥)

exporters:
  # AWS X-Rayë¡œ íŠ¸ë ˆì´ìŠ¤ ì „ì†¡
  awsxray:
    region: ap-northeast-2
    no_verify_ssl: false
    
  # CloudWatch Logsë¡œ ë¡œê·¸ ì „ì†¡
  awscloudwatchlogs:
    region: ap-northeast-2
    log_group_name: "/aws/application/monikit"
    log_stream_name: "application-logs"
    
  # CloudWatch Metricsë¡œ ë©”íŠ¸ë¦­ ì „ì†¡
  awscloudwatchmetrics:
    region: ap-northeast-2
    namespace: "MoniKit/Application"
    dimension_rollup_option: "NoDimensionRollup"
    
  # ğŸ”§ ê°œë°œìš©: Jaegerë¡œ íŠ¸ë ˆì´ìŠ¤ ì „ì†¡ (ì„ íƒì‚¬í•­)
  jaeger:
    endpoint: jaeger:14250
    tls:
      insecure: true
      
  # ğŸ“Š ê°œë°œìš©: Prometheusë¡œ ë©”íŠ¸ë¦­ ì „ì†¡ (ì„ íƒì‚¬í•­)
  prometheus:
    endpoint: "0.0.0.0:8888"

service:
  pipelines:
    # íŠ¸ë ˆì´ìŠ¤ íŒŒì´í”„ë¼ì¸
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [awsxray]  # ìš´ì˜: AWS X-Rayë§Œ ì‚¬ìš©
      # exporters: [awsxray, jaeger]  # ê°œë°œ: ë‘˜ ë‹¤ ì‚¬ìš©
      
    # ë¡œê·¸ íŒŒì´í”„ë¼ì¸  
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [awscloudwatchlogs]
      
    # ë©”íŠ¸ë¦­ íŒŒì´í”„ë¼ì¸
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [awscloudwatchmetrics]
      # exporters: [awscloudwatchmetrics, prometheus]  # ê°œë°œ: ë‘˜ ë‹¤ ì‚¬ìš©

  extensions: [health_check, pprof, zpages]
